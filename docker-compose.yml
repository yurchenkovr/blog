# Docker Compose file Reference (https://docs.docker.com/compose/compose-file/)

version: '3'

# Define services
services:

  # App Service
  app:
    build:
      context: ./
      dockerfile: src/cmd/api/Dockerfile
    ports:
      - "8080:8080"
    depends_on:
      - grpc
      - postgres
      - nats-server
    entrypoint: ./src/cmd/api/entrypoint.sh
    command: ./src/cmd/api/api

  # Postgres Service
  postgres:
    image: "postgres:10-alpine"
    restart: unless-stopped

  #gRPC Service
  grpc:
    build:
      context: ./
      dockerfile: src/cmd/cmdmanager/Dockerfile
    ports:
      - "50051:50051"
    command: ./src/cmd/cmdmanager/cmdmanager
    restart: unless-stopped

  #Nats Service
  nats:
    build:
      context: ./
      dockerfile: src/cmd/nats/Dockerfile
    ports:
      - "8000:8000"
    command: ./src/cmd/nats/nats
    restart: unless-stopped

  #Nats Server
  nats-server:
    image: 'nats:2.0.4'
    hostname: nats-server
